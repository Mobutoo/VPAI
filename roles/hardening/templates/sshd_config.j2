# {{ ansible_managed }}

Port {{ hardening_ssh_port }}
{% if hardening_vpn_ready | default(false) | bool %}
ListenAddress {{ hardening_ssh_listen_address }}
{% else %}
# ANTI-LOCKOUT: VPN not ready or force_open=true â€” listening on all interfaces
ListenAddress 0.0.0.0
{% endif %}

PermitRootLogin no
PasswordAuthentication no
PubkeyAuthentication yes
AuthorizedKeysFile .ssh/authorized_keys

MaxAuthTries {{ hardening_ssh_max_auth_tries }}
LoginGraceTime {{ hardening_ssh_login_grace_time }}
ClientAliveInterval {{ hardening_ssh_client_alive_interval }}
ClientAliveCountMax {{ hardening_ssh_client_alive_count_max }}

X11Forwarding no
AllowTcpForwarding no
AllowAgentForwarding no
PermitTunnel no

AllowUsers {{ hardening_ssh_allowed_user }}

UsePAM yes
PrintMotd no
AcceptEnv LANG LC_*
Subsystem sftp /usr/lib/openssh/sftp-server
