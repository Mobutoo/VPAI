---
# vpn-dns â€” defaults
# Headscale extra_records for Split DNS (admin domains -> VPS Tailscale IP)

# Path on the Headscale server where extra_records JSON is stored
vpn_dns_extra_records_path: "/etc/headscale/extra-records.json"

# Headscale service name (for restart handler)
vpn_dns_headscale_service: "headscale"

# Admin domains to register (built from inventory variables)
# Each entry maps a domain to the Tailscale IP of the target VPS
vpn_dns_records: "{{ _vpn_dns_records_default }}"

# Internal: build default records list from standard variables
# Uses the tailscale_ip fact set by headscale-node role on prod-server
_vpn_dns_admin_domain: "{{ admin_subdomain | default('admin') }}.{{ domain_name }}"
_vpn_dns_n8n_domain: "{{ n8n_subdomain | default('') }}.{{ domain_name }}"

_vpn_dns_records_default: >-
  {{
    [{"name": _vpn_dns_admin_domain, "type": "A",
      "value": hostvars[groups['prod'][0]]['tailscale_ip']}]
    +
    ([{"name": _vpn_dns_n8n_domain, "type": "A",
       "value": hostvars[groups['prod'][0]]['tailscale_ip']}]
     if (n8n_subdomain | default('')) | length > 0
     else [])
  }}
