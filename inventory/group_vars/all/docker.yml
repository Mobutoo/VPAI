---
# inventory/group_vars/all/docker.yml — Configuration Docker

# --- Docker daemon ---
docker_log_max_size: "10m"
docker_log_max_file: "3"
docker_storage_driver: "overlay2"
docker_live_restore: true
docker_default_address_pool_base: "172.20.0.0/16"
docker_default_address_pool_size: 24

# --- Docker networks ---
docker_network_frontend_subnet: "172.20.1.0/24"
docker_network_backend_subnet: "172.20.2.0/24"
docker_network_monitoring_subnet: "172.20.3.0/24"
docker_network_egress_subnet: "172.20.4.0/24"
docker_network_sandbox_subnet: "172.20.5.0/24"

# --- Resource limits (prod / preprod) ---
# PostgreSQL
postgresql_memory_limit: "{{ '1536M' if target_env == 'prod' else '768M' }}"
postgresql_memory_reservation: "{{ '512M' if target_env == 'prod' else '256M' }}"
postgresql_cpu_limit: "{{ '1.5' if target_env == 'prod' else '0.75' }}"

# Redis (768M prod: exact cache + semantic cache metadata)
redis_memory_limit: "{{ '768M' if target_env == 'prod' else '384M' }}"
redis_memory_reservation: "128M"
redis_cpu_limit: "0.5"

# n8n
n8n_memory_limit: "{{ '1024M' if target_env == 'prod' else '512M' }}"
n8n_memory_reservation: "256M"
n8n_cpu_limit: "1.0"

# OpenClaw (Node.js — needs 1.5GB+ for heap, see NODE_OPTIONS in env)
openclaw_memory_limit: "{{ '1536M' if target_env == 'prod' else '768M' }}"
openclaw_memory_reservation: "384M"
openclaw_cpu_limit: "1.0"

# LiteLLM (needs 1GB+ for PostgreSQL + Redis cache + model routing)
litellm_memory_limit: "{{ '1024M' if target_env == 'prod' else '512M' }}"
litellm_memory_reservation: "256M"
litellm_cpu_limit: "1.0"

# Qdrant (1536M prod: 2 collections — semantic_cache + content_index RAG)
qdrant_memory_limit: "{{ '1536M' if target_env == 'prod' else '768M' }}"
qdrant_memory_reservation: "256M"
qdrant_cpu_limit: "0.75"

# Grafana
grafana_memory_limit: "384M"
grafana_memory_reservation: "128M"
grafana_cpu_limit: "0.5"

# VictoriaMetrics
victoriametrics_memory_limit: "512M"
victoriametrics_memory_reservation: "128M"
victoriametrics_cpu_limit: "0.5"

# Loki
loki_memory_limit: "384M"
loki_memory_reservation: "128M"
loki_cpu_limit: "0.5"

# Alloy
alloy_memory_limit: "256M"
alloy_memory_reservation: "64M"
alloy_cpu_limit: "0.25"

# Caddy
caddy_memory_limit: "256M"
caddy_memory_reservation: "64M"
caddy_cpu_limit: "0.5"

# cAdvisor (container metrics collector)
cadvisor_memory_limit: "256M"
cadvisor_memory_reservation: "64M"
cadvisor_cpu_limit: "0.25"

# DIUN
diun_memory_limit: "128M"
diun_memory_reservation: "32M"
diun_cpu_limit: "0.25"
