# Heartbeat â€” Instructions periodiques pour Mobutoo

Ce document est lu par le Concierge a chaque activation du heartbeat (toutes les 30 minutes, 8h-22h).

---

## Verification de sante

### Services critiques a sondrer (si pas d'alerte recente)
- Verifier si Maintainer a signale des incidents recemment
- Si aucune alerte depuis plus de 2h : `sessions_spawn({{ openclaw_agent_maintainer_name }}, "/stack status")`
- Si un service est DOWN : notifier Telegram immediatement

---

## Suivi projets Kaneo

### 1. Recuperer l'etat des projets actifs
```
sessions_spawn({{ openclaw_agent_messenger_name }}, "get_project")
```
Hermes retourne la liste de tous les projets. Identifier ceux avec des taches actives.

### 2. Analyser les taches en cours
Pour chaque projet avec taches `in-progress` :
```
sessions_spawn({{ openclaw_agent_messenger_name }}, "get_tasks projectId=<id>")
```

### 3. Detecter les anomalies

**Taches bloquees** (label `blocked`) :
- Identifier l'agent bloque et la raison
- Si besoin de deblocage : escalader au Concierge principal (toi)
- Notifier Telegram : "Tache bloquee : <titre> (agent : <agentId>)"

**Taches sans progres** (in-progress depuis > 2h sans commentaire recent) :
- Verifier si le sous-agent est toujours actif
- Si inactif : reprendre la tache (re-spawner le sous-agent avec le meme contexte)
- Notifier Telegram : "Tache inactive > 2h : <titre>"

**Projets termines non notifies** (toutes taches done mais pas de recap) :
```
sessions_spawn({{ openclaw_agent_messenger_name }}, "add_comment taskId=<project_main_task> content=Projet complete. Toutes les taches sont done.")
```
Envoyer recap Telegram : temps total, livrables produits.

**Compteurs de corrections depassÃ©s** (`kaneo:corrections:<task_id>` > 2 dans Redis) :
- Escalader au Concierge : "BOUCLE DE CORRECTIONS DETECTEE sur tache <id>"
- Notifier Telegram avec le detail

### 4. Max 3 projets actifs simultanes
Si plus de 3 projets en cours : "Attention â€” {{ "{{" }} nb {{ "}}" }} projets actifs. Prioritiser avec l'utilisateur."

---

## Digest quotidien (cron 9h)

Le cron `project-digest` a 9h declenche automatiquement un message :
"Fais le point sur tous les projets Kaneo actifs via le messenger. Resume par projet : taches done/total, temps passe, livrables produits, blocages. Envoie le resume sur Telegram."

---

---

## IdÃ©es en attente de validation

### Rappel automatique (si idÃ©e en review depuis > 4h)

VÃ©rifier si `memory/ideas.md` contient des idÃ©es avec statut "In Review" :
- Si oui, et si la derniÃ¨re modification date de > 4h :
  - VÃ©rifier la clÃ© Redis : `idea:{task_id}:reminded` (TTL 1h)
  - Si clÃ© absente ou expirÃ©e : envoyer sur Telegram :
    > "ðŸ’¡ Tu as une idÃ©e en attente de validation depuis +4h : **<titre>** [<domain>]. RÃ©ponds 'approuve', 'modifie : <feedback>' ou 'refuse'."
  - `redis-cli -h redis SETEX idea:{task_id}:reminded 3600 true`
  - Max 1 rappel par heure par idÃ©e

### Mise Ã  jour de memory/ideas.md

Le Messenger Ã©crit dans ce fichier Ã  chaque `create_idea_plan`, `update_idea`, `approve_idea`, `reject_idea`.
OpenClaw (v2026.2.22) indexe automatiquement ce fichier via `memorySearch` â†’ recall sÃ©mantique natif.

---

## Regles du heartbeat

- **Ne spawner Messenger que si necessaire** (eviter les appels redondants)
- **Pas d'action destructrice** depuis le heartbeat â€” uniquement lecture + alertes
- **Max 2 sous-agents** spawnes par cycle de heartbeat
- **Si tout va bien** : pas de notification (silence = OK)
- **Si anomalie** : 1 message Telegram concis, clair, actionnable
