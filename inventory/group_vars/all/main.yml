---
# inventory/group_vars/all/main.yml — Variables generales (wizard)
# Genere par scripts/wizard.sh le 2026-02-15 20:18
# Source unique de verite — Remplir avant tout deploiement

# --- Identite projet ---
project_name: "javisi"
project_display_name: "Javisi"
project_description: "Stack AI/automatisation auto-hebergee"
project_repo_url: "git@github.com:Mobutoo/VPAI.git"
project_repo_branch: "main"

# --- Domaine & DNS ---
domain_name: "{{ vault_domain_name | default('example.com') }}"
domain_registrar: "ovh"
dns_api_endpoint: "ovh-eu"
admin_subdomain: "javisi"
grafana_subdomain: "tala"
n8n_subdomain: "mayi"
litellm_subdomain: "llm"
qdrant_subdomain: "qd"
subdomain_preprod: "preprod"

# --- VPN Access Control ---
# Set to false to make admin UIs publicly accessible (for initial validation)
# Set to true to enforce VPN-only access (production hardening)
caddy_vpn_enforce: true

# --- VPS Production ---
prod_provider: "ovh"
prod_hostname: "{{ vault_prod_hostname | default('vps-prod-01') }}"
prod_ip: "{{ vault_prod_ip | default('127.0.0.1') }}"
prod_os: "debian-13"
prod_ram_gb: 8
prod_cpu_cores: 4
prod_disk_gb: 75
prod_ssh_port: 804
prod_user: "mobuone"

# --- VPS VPN (existant) ---
vpn_provider: "ionos"
vpn_hostname: "{{ vault_vpn_hostname | default('seko-vpn') }}"
vpn_headscale_url: "{{ vault_vpn_headscale_url | default('https://vpn.example.com') }}"
vpn_headscale_ip: "{{ vault_vpn_headscale_ip | default('127.0.0.1') }}"
vpn_network_cidr: "100.64.0.0/10"

# --- Pre-production (Hetzner Cloud) ---
preprod_provider: "hetzner"
preprod_server_type: "cx23"
preprod_location: "fsn1"
preprod_os_image: "debian-13"

# --- Stockage S3 (Hetzner Object Storage) ---
s3_provider: "hetzner"
s3_region: "fsn1"
s3_endpoint: "fsn1.your-objectstorage.com"
s3_bucket_backups: "{{ vault_s3_bucket_backups | default('vpai-backups') }}"
s3_bucket_shared: "{{ vault_s3_bucket_shared | default('vpai-shared') }}"

# --- Backup GFS Retention (Grandfather-Father-Son) ---
backup_gfs_keep_daily: 7
backup_gfs_keep_weekly: 4
backup_gfs_keep_monthly: 6
backup_gfs_keep_yearly: 2

# --- Notifications ---
notification_method: "telegram"
notification_email: "{{ vault_notification_email | default('') }}"

# Telegram monitoring bot (shared with Seko-VPN)
telegram_monitoring_bot_token: "{{ vault_telegram_monitoring_bot_token | default('') }}"
telegram_monitoring_chat_id: "{{ vault_telegram_monitoring_chat_id | default('') }}"

# Telegram OpenClaw bot (dedicated)
telegram_openclaw_bot_token: "{{ vault_telegram_openclaw_bot_token | default('') }}"
telegram_openclaw_chat_id: "{{ vault_telegram_openclaw_chat_id | default('') }}"

# Webhook URL kept for Discord/Slack backward compatibility
notification_webhook_url: "{{ vault_notification_webhook_url | default('') }}"

# --- Timezone ---
timezone: "Europe/Paris"
locale: "fr_FR.UTF-8"

# --- Environment ---
target_env: "prod"

# --- Services Passwords & Keys (from vault) ---
# PostgreSQL (shared password for all databases)
postgresql_password: "{{ vault_postgresql_password }}"

# Redis
redis_password: "{{ vault_redis_password }}"

# n8n
n8n_encryption_key: "{{ vault_n8n_encryption_key }}"
n8n_owner_password: "{{ vault_n8n_owner_password | default('') }}"

# LiteLLM
litellm_master_key: "{{ vault_litellm_master_key }}"
litellm_ui_username: "{{ vault_litellm_ui_username | default('admin') }}"
litellm_ui_password: "{{ vault_litellm_ui_password | default('') }}"
litellm_salt_key: "{{ vault_litellm_salt_key }}"

# AI Provider API Keys
anthropic_api_key: "{{ vault_anthropic_api_key }}"
openai_api_key: "{{ vault_openai_api_key }}"
openrouter_api_key: "{{ vault_openrouter_api_key | default('') }}"
google_gemini_api_key: "{{ vault_google_gemini_api_key | default('') }}"
byteplus_api_key: "{{ vault_byteplus_api_key | default('') }}"
brave_search_api_key: "{{ vault_brave_search_api_key | default('') }}"

# OpenClaw
openclaw_api_key: "{{ vault_openclaw_api_key }}"
# Gateway token for OpenClaw Control UI auth (generate: openssl rand -hex 32)
openclaw_gateway_token: "{{ vault_openclaw_gateway_token | default(vault_openclaw_api_key) }}"

# Grafana
grafana_admin_user: "{{ vault_grafana_admin_user | default('admin') }}"
grafana_admin_password: "{{ vault_grafana_admin_password }}"

# Qdrant
qdrant_api_key: "{{ vault_qdrant_api_key }}"

# Sure (personal finance)
sure_secret_key_base: "{{ vault_sure_secret_key_base }}"
sure_db_password: "{{ vault_sure_db_password | default(postgresql_password) }}"
sure_api_key: "{{ vault_sure_api_key | default('') }}"

# GitHub webhook (auto-fix pipeline)
github_webhook_secret: "{{ vault_github_webhook_secret | default('') }}"

# --- n8n <-> OpenClaw integration ---
n8n_webhook_secret: "{{ vault_n8n_webhook_secret | default('') }}"
n8n_webhook_base_url: "http://n8n:5678"

# --- Qdrant collections (semantic cache + RAG) ---
qdrant_cache_collection: "semantic_cache"
qdrant_rag_collection: "content_index"
qdrant_embedding_model: "text-embedding-3-small"
qdrant_embedding_dimensions: 1536

# --- LiteLLM budget caps (USD per day) ---
# Budget global cross-providers (hard cap absolu)
litellm_budget_global_daily: 5.00

# Budget par provider (somme = budget global)
# Répartition : OpenRouter 65%, Anthropic 15%, OpenAI 10%, Google 5%, zAI 5%
litellm_anthropic_budget_daily: 0.75
litellm_openai_budget_daily: 0.50
litellm_openrouter_budget_daily: 3.25
litellm_google_budget_daily: 0.25

# Seuils d'alerte (% du budget global) — notification Telegram
litellm_budget_alert_warning: 0.70   # 70% → alerte warning
litellm_budget_alert_critical: 0.90  # 90% → bascule automatique mode éco

# Mode éco : modèles gratuits/ultra-low en fallback (qwen3-coder, glm-5, deepseek-v3)
# Contrôlé par Redis key "litellm:budget:mode" = normal | eco | blocked
litellm_budget_eco_models: ["qwen3-coder", "glm-5", "deepseek-v3"]

# BytePlus — Seedance vidéo (ponctuel, budget MENSUEL séparé du $5/jour)
# Non comptabilisé dans le budget global journalier
litellm_byteplus_budget_monthly: 5.00

# --- WhatsApp (OpenClaw Tutor channel — child tablet) ---
whatsapp_tutor_enabled: false
# whatsapp_tutor_phone set in vault if needed

# Backup heartbeat (uptime monitoring)
backup_heartbeat_url: "{{ vault_backup_heartbeat_url | default('') }}"

# --- OVH API (ACME DNS-01 — mode VPN-only uniquement) ---
# Créer les credentials sur https://eu.api.ovh.com/createToken/
# Droits requis : GET/POST/PUT /domain/zone/* + GET /auth/currentCredential
ovh_endpoint: "{{ vault_ovh_endpoint | default('ovh-eu') }}"
ovh_application_key: "{{ vault_ovh_application_key | default('') }}"
ovh_application_secret: "{{ vault_ovh_application_secret | default('') }}"
ovh_consumer_key: "{{ vault_ovh_consumer_key | default('') }}"

# --- Webhook Relay (Seko-VPN → VPS via Headscale mesh) ---
# Remplace Cloudflare Tunnel : 100% auto-hébergé, zéro tiers.
# Architecture : Meta → hook.<domain> (Seko-VPN IP publique) → Caddy apt → VPN mesh → VPS
# Prérequis : DNS A record hook.<domain> → IP publique Seko-VPN
webhook_subdomain: "hook"
webhook_relay_domain: "{{ webhook_subdomain }}.{{ domain_name }}"
vpn_server_public_ip: "{{ vault_vpn_server_public_ip | default('') }}"
vps_tailscale_ip: "{{ vault_vps_tailscale_ip | default('') }}"

# --- Workstation Pi (RPi5 16GB) ---
workstation_pi_hostname: "workstation-pi"
workstation_pi_user: "mobuone"
workstation_pi_ip: "{{ vault_workstation_pi_ip | default('127.0.0.1') }}"
# Tailscale IP — used by n8n (on VPS) to reach RPi via mesh VPN for SSH autofix
workstation_pi_tailscale_ip: "{{ vault_workstation_pi_tailscale_ip | default('') }}"
workstation_pi_become_pass: "{{ vault_workstation_become_pass }}"
workstation_pi_ram_gb: 16
workstation_pi_disk_gb: 256

# Kaneo (PM tool — replaces Mission Control)
kaneo_subdomain_override: "hq"
# Agent service account — used by n8n workflows + OpenClaw Messenger for BetterAuth API calls.
# Add vault_kaneo_agent_email + vault_kaneo_agent_password to secrets.yml (ansible-vault edit).
kaneo_agent_email: "{{ vault_kaneo_agent_email | default('') }}"
kaneo_agent_password: "{{ vault_kaneo_agent_password | default('') }}"
# Shared password for 10 OpenClaw agent service accounts in Kaneo.
# Add vault_kaneo_agents_password to secrets.yml (ansible-vault edit).
kaneo_agents_password: "{{ vault_kaneo_agents_password | default('') }}"
# Workspace ID for direct DB membership inserts (BetterAuth add-member endpoint not available in v2.x).
# Find via: docker exec <pg> psql -U kaneo -d kaneo -t -c "SELECT id FROM workspace LIMIT 1;"
kaneo_workspace_id: "{{ vault_kaneo_workspace_id | default('') }}"

# === PALAIS ===
palais_subdomain: "palais"

# Sure (personal finance)
sure_subdomain: "nzimbu"

# Auto-Fix Pipeline (GitHub Issues -> Claude Code -> PR)
autofix_enabled: true
autofix_label: "auto-fix"
autofix_repos:
  - name: "VPAI"
    url: "git@github-seko:Mobutoo/VPAI.git"
    default_agent: "builder"
  - name: "kaneo-vpai"
    url: "git@github-seko:Mobutoo/kaneo-vpai.git"
    default_agent: "builder"
autofix_workspace: "/home/{{ workstation_pi_user }}/projects/autofix"

# OpenCode
oc_subdomain: "oc"

# ComfyUI + Remotion + OpenCut (workstation Pi)
# Doit etre declare ici (pas seulement dans role defaults) pour que vpn-dns
# puisse construire les extra_records Headscale depuis vpn-server.
comfyui_subdomain: "studio"
remotion_subdomain: "re"
opencut_subdomain: "cut"

# --- Prod Apps (Hetzner CX22) ---
app_prod_hostname: "app-prod-01"
app_prod_location: "fsn1"
app_prod_server_type: "cx22"
app_prod_os_image: "ubuntu-24.04"
app_prod_ip: "{{ vault_app_prod_ip | default('127.0.0.1') }}"

# --- Cle SSH deploy (utilisee par provision-hetzner) ---
deploy_ssh_key_name: "{{ project_name }}-deploy"
deploy_ssh_key_pub_path: "~/.ssh/id_ed25519.pub"
