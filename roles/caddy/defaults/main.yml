---
# caddy — defaults

caddy_image_tag: "{{ caddy_image }}"
caddy_config_dir: "/opt/{{ project_name }}/configs/caddy"
caddy_data_dir: "/opt/{{ project_name }}/data/caddy"
caddy_domain: "{{ domain_name }}"
caddy_admin_domain: "{{ admin_subdomain | default('admin') }}.{{ domain_name }}"
caddy_grafana_domain: "{{ grafana_subdomain | default('') }}.{{ domain_name }}"
caddy_n8n_domain: "{{ n8n_subdomain | default('') }}.{{ domain_name }}"
caddy_litellm_domain: "{{ litellm_subdomain | default('') }}.{{ domain_name }}"
caddy_qdrant_domain: "{{ qdrant_subdomain | default('') }}.{{ domain_name }}"
caddy_vpn_cidr: "{{ vpn_network_cidr }}"
# Set to false to disable VPN restriction (public access to admin UIs)
# Use for initial validation, then set to true to enforce VPN-only access
caddy_vpn_enforce: true
caddy_notification_email: "{{ notification_email }}"
caddy_rate_limit_events: 100
caddy_rate_limit_window: "1m"

# === VPN-ONLY MODE ===
# Bascule complète de l'infrastructure en accès VPN uniquement.
# Quand true :
#   - Caddy utilise ACME DNS-01 (OVH) au lieu de HTTP-01 → port 80 inutile
#   - UFW ferme le port 80 et restreint le 443 au CIDR VPN uniquement
#   - Les webhooks Instagram sont routés via Cloudflare Tunnel (cloudflared)
#   - L'image Caddy custom (plugin ovh) est buildée sur le serveur
# DEFAULT: false — ne pas activer avant validation VPN complète
caddy_vpn_only_mode: false

# Provider DNS pour challenge ACME DNS-01 (requis si caddy_vpn_only_mode=true)
# Actuellement configuré : ovh
# Credentials requis dans secrets.yml : ovh_application_key, ovh_application_secret,
#   ovh_consumer_key, ovh_endpoint (ex: ovh-eu)
caddy_dns_provider: "ovh"

# Endpoints webhook publics exposés via Cloudflare Tunnel (caddy_vpn_only_mode=true)
# Meta/Instagram doit pouvoir atteindre ces paths depuis Internet
caddy_public_webhook_paths:
  - "/webhook/ig-comment"
  - "/webhook/ig-dm"
