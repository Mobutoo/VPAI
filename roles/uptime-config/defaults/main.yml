---
# uptime-config — defaults

# n8n URL: dedicated subdomain if set, otherwise sub-path on admin domain
_n8n_base: >-
  {{ ('https://' ~ n8n_subdomain ~ '.' ~ domain_name)
     if (n8n_subdomain | default('')) | length > 0
     else ('https://' ~ caddy_admin_domain ~ '/n8n') }}

# --- Uptime Kuma monitors ---
# These are documented in RUNBOOK.md for manual creation on Seko-VPN
uptime_kuma_monitors:
  - name: "{{ project_display_name }} — HTTPS"
    type: "http"
    url: "https://{{ domain_name }}/health"
    interval: 60
    retryInterval: 30
    maxretries: 2
    accepted_statuscodes: ["200"]

  - name: "{{ project_display_name }} — n8n"
    type: "http"
    url: "{{ _n8n_base }}/healthz"
    interval: 60
    retryInterval: 30
    maxretries: 3

  - name: "{{ project_display_name }} — Grafana"
    type: "http"
    url: "https://{{ caddy_admin_domain }}/grafana/api/health"
    interval: 120
    maxretries: 3

  - name: "{{ project_display_name }} — PostgreSQL"
    type: "port"
    hostname: "{{ vpn_headscale_ip }}"
    port: 5432
    interval: 120
    maxretries: 2

  - name: "{{ project_display_name }} — TLS Certificate"
    type: "http"
    url: "https://{{ domain_name }}"
    interval: 86400
    expiryNotification: true
    maxredirects: 0

  - name: "{{ project_display_name }} — Backup Heartbeat"
    type: "push"
    interval: 86400
