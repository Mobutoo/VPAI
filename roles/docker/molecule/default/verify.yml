---
- name: Verify docker role
  hosts: all
  gather_facts: false
  tasks:
    - name: Check Docker is installed
      ansible.builtin.command:
        cmd: docker --version
      changed_when: false

    - name: Check Docker Compose plugin is installed
      ansible.builtin.command:
        cmd: docker compose version
      changed_when: false

    - name: Check daemon.json exists
      ansible.builtin.stat:
        path: /etc/docker/daemon.json
      register: daemon_json
      failed_when: not daemon_json.stat.exists

    - name: Check Docker service is running
      ansible.builtin.systemd:
        name: docker
      register: docker_service
      failed_when: docker_service.status.ActiveState != "active"

    - name: Check cleanup script exists
      ansible.builtin.stat:
        path: /usr/local/bin/docker-cleanup.sh
      register: cleanup_script
      failed_when: not cleanup_script.stat.exists
