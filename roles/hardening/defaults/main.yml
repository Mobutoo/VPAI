---
# hardening — defaults

# --- SSH ---
hardening_ssh_port: "{{ prod_ssh_port_target | default(prod_ssh_port) }}"
hardening_ssh_listen_address: "{{ vpn_headscale_ip }}"
hardening_ssh_allowed_user: "{{ prod_user }}"
hardening_ssh_max_auth_tries: 3
hardening_ssh_login_grace_time: 30
hardening_ssh_client_alive_interval: 300
hardening_ssh_client_alive_count_max: 2
hardening_ssh_authorized_keys: "{{ ssh_authorized_keys }}"

# --- Anti-lockout ---
# Force SSH to listen on all interfaces and allow SSH from anywhere.
# Use this for first deploy or debug sessions when VPN is not yet ready.
# Set to true to bypass VPN-only SSH restriction.
# DEFAULT: true for safety - set to false ONLY after confirming VPN works
hardening_ssh_force_open: true

# --- Fail2Ban ---
hardening_fail2ban_bantime: 3600
hardening_fail2ban_findtime: 600
hardening_fail2ban_maxretry: 3
hardening_fail2ban_caddy_maxretry: 10
hardening_fail2ban_caddy_botsearch_maxretry: 5
hardening_fail2ban_caddy_botsearch_bantime: 86400

# --- UFW ---
# Mode standard : ports 80 (ACME HTTP-01) et 443 (HTTPS public) ouverts à tous.
# Mode VPN-only (hardening_vpn_only_mode=true) :
#   - port 80 fermé (ACME DNS-01 OVH, pas besoin du challenge HTTP)
#   - port 443 restreint au CIDR VPN uniquement
#   - cloudflared reçoit les webhooks via connexion sortante (aucun port entrant requis)
# PRÉREQUIS avant activation :
#   1. caddy_vpn_only_mode=true configuré et déployé
#   2. ACME DNS-01 OVH testé et certificats valides
#   3. Split DNS Headscale configuré (extra_records → IP Tailscale du VPS)
#   4. Cloudflare Tunnel opérationnel si webhooks Instagram requis
# DEFAULT: false — ne pas activer avant validation complète
hardening_vpn_only_mode: false

hardening_ufw_allowed_tcp_ports:
  - "80"
  - "443"

hardening_ufw_vpn_network: "{{ vpn_network_cidr }}"
hardening_ufw_tailscale_port: "41641"

# --- CrowdSec ---
hardening_crowdsec_collections:
  - crowdsecurity/linux
  - crowdsecurity/sshd
  - crowdsecurity/nginx
  - crowdsecurity/http-cve

# --- Unattended upgrades ---
hardening_unattended_upgrades_origins:
  - "origin=Debian,codename=${distro_codename},label=Debian-Security"

hardening_unattended_auto_reboot: "false"
