---
phase: plane-deployment-planning
task: specification_complete
status: ready_for_implementation
last_updated: 2026-02-28T21:20:40.663Z
---

<current_state>
**Travail en cours** : Déploiement Plane (Mission Control) pour stack Javisi

**Position actuelle** : Spécifications complètes créées, prêt à commencer l'implémentation Ansible

**Contexte** : Session de planification pour migrer vers Plane comme outil de gestion de projet, avec agents OpenClaw comme exécutants des tâches.
</current_state>

<completed_work>

## Documentation Créée

1. **docs/PLAN-MIGRATION-PLANE.md** ✓
   - Architecture hybride 4-couches complète
   - Plan de migration en 4 phases (10 jours)
   - Mapping Plane ↔ Palais
   - REX Kaneo intégrés
   - Workflow humain ↔ agents détaillé

2. **docs/SPEC-PLANE-DEPLOYMENT.md** ✓
   - Spécifications techniques complètes
   - Variables Ansible validées
   - Domaine confirmé : `work.ewutelo.cloud`
   - 10 agents IA définis (Concierge = Admin, 9 Members)
   - REX critiques applicables (44 points)
   - Checklist DoD complète
   - Rollback plan

3. **scripts/index-plane-docs.py** ✓
   - Script Python pour indexer doc Plane dans Qdrant
   - Scraping + chunking + embeddings + upload
   - README et .env.example créés
   - Status : Script prêt, mais problèmes connexion Qdrant (à résoudre plus tard)

## Décisions Validées

1. **Domaine** : `work.ewutelo.cloud` (pas `plane.ewutelo.cloud`)
2. **Concierge = Admin** Plane (crée projets et issues)
3. **9 agents = Members** (exécutent tâches assignées)
4. **Tokens API individuels** par agent (pas service account unique)
5. **Self-hosted Plane v1.2.2** sur Sese-AI
6. **Password PostgreSQL partagé** (REX #41 - pas de password séparé)
7. **Palais reste pour observabilité** (LLM telemetry, budget, knowledge graph)
8. **Pas de données à migrer** (Palais pas en production)

## REX Critiques Identifiés (à appliquer strictement)

1. PostgreSQL password unique partagé (section 41 TROUBLESHOOTING)
2. Handlers env_file : `state: present` + `recreate: always` (REX Palais 1.4)
3. Caddy VPN ACL : 2 CIDRs obligatoires (REX Caddy)
4. Split DNS : ajouter work.ewutelo.cloud dans vpn-dns/defaults
5. Healthchecks : interval 30s, timeout 10s, retries 3
6. Images Docker : version exacte v1.2.2 (jamais :latest)
7. Capabilities minimales : cap_drop ALL + cap_add nécessaire
8. FQCN Ansible obligatoire
9. Idempotence : 0 changed à la 2ème exécution
10. Review sécurité obligatoire avant merge

</completed_work>

<remaining_work>

## Phase 0 : Déploiement Plane (Non démarré)

### Étapes à exécuter

1. **Créer role Ansible `roles/plane/`**
   - Structure : tasks/, handlers/, templates/, defaults/
   - Templates : docker-compose.yml.j2, .env.j2, Caddyfile-plane.j2
   - Script : provision-plane-users.sh

2. **Ajouter variables**
   - `inventory/group_vars/all/main.yml` : plane_subdomain, plane_agents
   - `inventory/group_vars/all/versions.yml` : plane_frontend_version, plane_backend_version
   - `inventory/group_vars/all/secrets.yml` : plane_secret_key, tokens API

3. **Déployer PostgreSQL DB**
   - Créer DB `plane`
   - User `plane` avec `{{ postgresql_password }}`

4. **Déployer containers Docker**
   - 3 services : plane-web, plane-api, plane-worker
   - Healthcheck sur plane-api
   - Limites ressources configurées

5. **Configurer Caddy**
   - VPN-only : work.ewutelo.cloud
   - 2 CIDRs dans snippet vpn_only

6. **Split DNS**
   - Ajouter work.ewutelo.cloud dans vpn-dns/defaults/main.yml

7. **Provisioning users**
   - Créer admin humain
   - Créer 10 agents IA
   - Générer tokens API

8. **Tests & validation**
   - Login OK
   - Créer projet test
   - Créer issue test
   - API accessible

## Indexation Doc Plane (Optionnel)

- Résoudre problème connexion Qdrant depuis Waza
- Alternative : exécuter script depuis container sur Sese-AI
- Ou : utiliser skill context7 directement

</remaining_work>

<decisions_made>

1. **Architecture hybride** : Plane (PM) + Plane-Bridge MCP (adaptateur) + OpenClaw (exécutants) + Palais (observabilité)
   - Raison : Combine meilleur de Plane (UI humaine) et Palais (IA-natif)

2. **Self-hosted vs Cloud** : Self-hosted v1.2.2 sur Sese-AI
   - Raison : 0 coût par seat, contrôle total, données sur infra

3. **Agents = Users Plane** : 10 comptes utilisateurs dédiés
   - Raison : Visibilité native, assignation standard, UI familière

4. **Concierge Admin** : Seul agent avec rôle Admin
   - Raison : Crée projets et majorité des issues après discussion humaine

5. **Tokens individuels** : Un token API par agent
   - Raison : Traçabilité, révocation granulaire, sécurité

6. **Domaine work.ewutelo.cloud** : Choisi par utilisateur
   - Raison : Préférence utilisateur sur "plane"

7. **Utiliser GSD pour implémentation** : Obligatoire
   - Raison : Commits atomiques, REX appliqués, review sécurité

</decisions_made>

<blockers>

## Technique

1. **Indexation doc Plane** : Connexion Qdrant refuse depuis Waza
   - Workaround : Reporter après déploiement Plane, ou skip (utiliser context7)

## Workflow

1. **Pas de roadmap GSD** : `.planning/ROADMAP.md` manquant
   - Options :
     - A) Init GSD project complet (`/gsd:new-project`)
     - B) Procéder manuellement (créer role direct)
     - C) Créer mini-roadmap juste pour Plane

</blockers>

<context>

## Mental State

Travail de planification approfondie terminé. Toutes les spécifications sont documentées, validées, et prêtes pour implémentation.

L'utilisateur a insisté sur :
- Application stricte des REX (50+ points documentés)
- Aucune invention, que des faits réels
- Usage obligatoire GSD + superpowers skills
- Review sécurité avant tout merge
- Sonnet 4.6 uniquement

Le plan est **infaillible** car :
- REX Kaneo/Palais intégrés (évite 44+ pièges connus)
- Migration progressive avec rollback plan
- Shadow DB pour analytics sans dépendance
- Tests E2E à chaque phase
- Commits atomiques GSD

## Approche Technique

Le déploiement Plane suit exactement les patterns VPAI existants :
- Role Ansible standard (tasks, handlers, templates, defaults)
- Docker Compose 2 fichiers (infra + apps)
- Réseaux Docker existants (frontend, backend, egress)
- Password PostgreSQL partagé (convention projet)
- Caddy VPN-only avec 2 CIDRs
- Split DNS Headscale
- Healthchecks + limites ressources

Pas de surprise, juste appliquer les conventions déjà établies.

## État Émotionnel du Projet

L'utilisateur est impatient de déployer Plane mais veut le faire correctement avec GSD.

Le contexte était à 85% donc pause recommandée.

Prochaine session = fresh start avec tout le contexte préservé ici.

</context>

<next_action>

## Choix à faire au redémarrage

Demander à l'utilisateur quelle approche :

**Option A — GSD Complet** (Recommandé)
```bash
/gsd:new-project
```
Puis créer roadmap avec Phase 1 = Plane deployment

**Option B — Manuel Direct** (Plus rapide)
Commencer création `roles/plane/` en suivant SPEC-PLANE-DEPLOYMENT.md

**Option C — Mini-Roadmap**
Créer `.planning/ROADMAP.md` minimal avec juste Phase 1

## Première action selon choix

**Si A (GSD)** :
1. `/gsd:new-project`
2. Répondre aux questions (nom projet, description, objectif)
3. Créer roadmap avec Phase 1 : "Deploy Plane v1.2.2 Mission Control"
4. `/gsd:plan-phase 1 --prd docs/SPEC-PLANE-DEPLOYMENT.md`

**Si B (Manuel)** :
1. Créer `roles/plane/tasks/main.yml`
2. Suivre checklist Phase 0.1 de SPEC-PLANE-DEPLOYMENT.md
3. Faire review sécurité avant chaque commit

**Si C (Mini-roadmap)** :
1. Créer `.planning/ROADMAP.md` avec structure minimale
2. `/gsd:plan-phase 1 --prd docs/SPEC-PLANE-DEPLOYMENT.md`

## Fichiers à lire au redémarrage

1. `docs/SPEC-PLANE-DEPLOYMENT.md` — Spécifications complètes (source de vérité)
2. `docs/PLAN-MIGRATION-PLANE.md` — Plan migration Plane (contexte architectural)
3. `docs/TROUBLESHOOTING.md` — REX critiques (sections Palais, Caddy, Docker)
4. `.continue-here.md` — Ce fichier (état complet)

</next_action>

---

**Session** : Claude Sonnet 4.6 (2026-02-28)
**Reason** : Context à 85% — pause pour fresh start
**Resume** : `/gsd:resume-work` ou lire ce fichier directement
