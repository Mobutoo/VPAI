# {{ ansible_managed }}
# Sure personal finance environment configuration

# Rails
RAILS_ENV=production
RACK_ENV=production
RAILS_LOG_TO_STDOUT=true
SELF_HOSTED=true
SECRET_KEY_BASE={{ sure_secret_key_base }}

# Database (PostgreSQL — shared instance)
DATABASE_URL=postgresql://{{ sure_db_user }}:{{ sure_db_password | urlencode }}@postgresql:5432/{{ sure_db_name }}

# Redis (shared instance — db{{ sure_redis_db }})
REDIS_URL=redis://:{{ redis_password }}@redis:6379/{{ sure_redis_db }}

# AI Chat via LiteLLM proxy (OpenAI-compatible)
# REX: Sure (Maybe Finance fork) lit OPENAI_ACCESS_TOKEN (pas API_KEY) et
#      OPENAI_URI_BASE (pas API_URL) — voir /rails/app/models/setting.rb
# Ces valeurs servent de defaults DB : Setting[:openai_access_token] = ENV[...]
{% if sure_ai_enabled | default(true) %}
OPENAI_ACCESS_TOKEN={{ litellm_master_key }}
OPENAI_URI_BASE=http://litellm:4000/v1/
OPENAI_MODEL={{ sure_default_model | default('gpt-4o-mini') }}
{% endif %}

# REX: Ne pas mettre ONBOARDING_STATE=closed avant le premier enregistrement.
# Laisser vide = "open" (permettre le signup initial).
# Après création du compte admin, Sure passe automatiquement en mode fermé
# (ou mettre ONBOARDING_STATE=closed manuellement après le premier boot).

# Timezone
TZ={{ timezone }}
